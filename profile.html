<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Мой профиль - Мой питомец</title>
    <link rel="stylesheet" href="style-profile.css">
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <img src="img/img3.png" alt="Логотип Мой питомец">
                <h1>Мой питомец</h1>
            </div>
            <nav class="nav">
                <a href="page1.html">Главная</a>
                <a href="page1.html" id="logoutBtn" class="btn-logout"><i class="fas fa-sign-out-alt"></i> Выйти</a>
            </nav>
        </div>
    </header>

    <main class="main">
        <div class="unauth" id="unauthorizedMessage" style="display: none;">
            <h2 class="card-title">Доступ запрещен</h2>
            <p>Для доступа к этой странице необходимо авторизоваться.</p>
            <a href="auth.html" style="display: inline-block; background: #4CAF50; color: white; padding: 15px 30px; border-radius: 25px; text-decoration: none; margin-top: 20px;">Перейти к странице входа</a>
        </div>

        <div id="authorizedContent" style="display: none;">
            <h1 class="title">Мой профиль</h1>      
            <div class="user">
                <img src="#########" class="avatar">
                <div class="information">
                    <h2 id="userName"></h2>
                    <span id="userEmail"></span>
                </div>
            </div>

            <div class="blocks">
                <div class="card">
                    <h2 class="card-title">Анкета питомца</h2>
                    <div class="pet-info">
                        <div>
                            <span class="info-label">Кличка</span>
                            <input type="text" class="pet-info-edit" id="petNameInput" placeholder="Имя вашего питомца" style="display: none">
                            <p class="pet-info-text" id="petNameText">Барсик</p>
                        </div>
                        <div>
                            <span class="info-label">Вид</span>
                            <input type="text" class="pet-info-edit" id="petSpecieInput" placeholder="Вид вашего питомца" style="display: none">
                            <p class="pet-info-text" id="petSpecieText">Собака</p>
                        </div>
                        <div>
                            <span class="info-label">Порода</span>
                            <input type="text" class="pet-info-edit" id="petBreedInput" placeholder="Порода вашего питомца" style="display: none">
                            <p class="pet-info-text" id="petBreedText">Долматинец</p>
                        </div>
                        <div>
                            <span class="info-label">Возраст</span>
                            <input type="text" class="pet-info-edit" id="petAgeInput" placeholder="Возраст вашего питомца" style="display: none">
                            <p class="pet-info-text" id="petAgeText">3 года</p>
                        </div>
                        <div>
                            <span class="info-label">Вес</span>
                            <input type="text" class="pet-info-edit" id="petWeightInput" placeholder="Вес вашего питомца" style="display: none">
                            <p class="pet-info-text" id="petWeightText">5.2 кг</p>
                        </div>
                        <div>
                            <span class="info-label">Рост</span>
                            <input type="text" class="pet-info-edit" id="petHeightInput" placeholder="Рост вашего питомца" style="display: none">
                            <p class="pet-info-text" id="petHeightText">25 см</p>
                        </div>
                        <div>
                            <span class="info-label">Дата рождения</span>
                            <input type="text" class="pet-info-edit" id="petBirthDateInput" placeholder="Дата рождения вашего питомца" style="display: none">
                            <p class="pet-info-text" id="petBirthDateText">15.04.2021</p>
                        </div>
                    </div>     
                    <div class="info-block" >
                        <span class="info-label">Награды </span>
                        <span class="awards">Достижения</span>
                        <p>1 место на выставке "Собаки Москвы 2023"</p> 
                        <p>Лучший представитель породы 2022</p>
                    </div>
                </div>

                <div class="card">
                    <h2 class="card-title">История посещений ветеринара</h2>    
                    <div class="list">
                        <div class="visit-item" id="visitItem" style="display: none">
                            <input type="text" id="newVisitInput" placeholder="Название ветклиники">
                            <input type="text" id="newVisitDate" placeholder="Дата посещения">
                            <input type="text" id="newVisitStatus" placeholder="Цель посещения">
                            <input type="text" id="newVisitProcedure" placeholder="Пройденные процедуры">
                            <button id="cancelVisitBtn">Отмена</button>
                            <button id="addVisitBtn">Добавить</button>
                        </div>
                        <ul class="visit-list" id="visitList">
                            <!-- Посещения будут добавляться здесь -->
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <h2 class="card-title">Принимаемые лекарства</h2>   
                    <div class="list">
                        <div class="medic-item" id="medicItem" style="display: none">
                            <input type="text" id="newMedicInput" placeholder="Название лекарства">
                            <input type="text" id="newMedicDate" placeholder="Время приема">
                            <input type="text" id="newMedicStatus" placeholder="Дозировка">
                            <input type="text" id="newMedicProcedure" placeholder="Назначение курса">
                            <button id="cancelMedicBtn">Отмена</button>
                            <button id="addMedicBtn">Добавить</button>
                        </div>
                        <ul class="medic-list" id="medicList">
                            <!-- Лекарства будут добавляться здесь -->
                        </ul>
                    </div>
                </div>
            </div>

            <div class="profile-actions">
                <button class="btn-profile" id="editPetProfileBtn">Редактировать профиль питомца</button>
                <button class="btn-save" id="savePetProfileBtn" style="display: none;">Сохранить изменения</button>
                <button class="btn-cancel" id="cancelPetProfileBtn" style="display: none;">Отмена</button>
                <button class="btn-visit" id="showVisitItemBtn">Добавить посещение</button>
                <button class="btn-medication" id="showMedicItemBtn">Добавить лекарство</button>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <div class="info">
                <h3>Мой питомец</h3>
                <p>Помогаем заботиться о ваших любимцах с 2025 года</p>
            </div>
            <div class="support">
                <h4>Поддержка</h4>
                <a href="mailto:support@mypet.com">support@mypet.com</a>
                <a href="tel:+79160000000">+7 (916) 000-00-00</a>
            </div>
            <div class="social">
                <h4>Мы в соцсетях</h4>
                <div class="social-icons">
                    <a href="#">Telegram</a>
                    <a href="#">ВКонтакте</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // Проверка авторизации
        function checkAuth() {
            const user = localStorage.getItem('currentUser');
            return user ? JSON.parse(user) : null;
        }

        // Выход из системы
        function logout() {
            localStorage.removeItem('currentUser');
            window.location.href = 'auth.html';
        }

        // Загрузка визитов и лекарств из localStorage
        function loadPetProfile() {
            const petProfile = localStorage.getItem('petProfile');
            return petProfile ? JSON.parse(petProfile) : null;
        }
        function loadVisits() {
            const visits = localStorage.getItem('userVisits');
            return visits ? JSON.parse(visits) : [];
        }
        function loadMedics() {
            const medics = localStorage.getItem('userMedics');
            return medics ? JSON.parse(medics) : [];
        }

        // Сохранение визитов и лекарств в localStorage
        function savePetProfile(petProfile) {
            localStorage.setItem('petProfile', JSON.stringify(petProfile));
        }
        function saveVisits(visits) {
            localStorage.setItem('userVisits', JSON.stringify(visits));
        }
        function saveMedics(medics) {
            localStorage.setItem('userMedics', JSON.stringify(medics));
        }

        // Отображение данных питомца
        function renderPetProfile() {
            const petProfile = loadPetProfile();
            
            if (petProfile) {
                document.getElementById('petNameText').textContent = petProfile.name || 'Не указано';
                document.getElementById('petSpecieText').textContent = petProfile.type || 'Не указано';
                document.getElementById('petBreedText').textContent = petProfile.breed || 'Не указано';
                document.getElementById('petAgeText').textContent = petProfile.age || 'Не указано';
                document.getElementById('petWeightText').textContent = petProfile.weight || 'Не указано';
                document.getElementById('petHeightText').textContent = petProfile.height || 'Не указано';
                document.getElementById('petBirthDateText').textContent = petProfile.birthDate || 'Не указано';

                document.getElementById('petNameInput').value = petProfile.name || '';
                document.getElementById('petSpecieInput').value = petProfile.type || '';
                document.getElementById('petBreedInput').value = petProfile.breed || '';
                document.getElementById('petAgeInput').value = petProfile.age || '';
                document.getElementById('petWeightInput').value = petProfile.weight || '';
                document.getElementById('petHeightInput').value = petProfile.height || '';
                document.getElementById('petBirthDateInput').value = petProfile.birthDate || '';
            }
        }

        // Включение режима редактирования
        function enableEditMode() {
            const textElements = document.querySelectorAll('.pet-info-text');
            textElements.forEach(element => {
                element.style.display = 'none';
            });
            
            const inputElements = document.querySelectorAll('.pet-info-edit');
            inputElements.forEach(element => {
                element.style.display = 'block';
            });
            
            document.getElementById('editPetProfileBtn').style.display = 'none';
            document.getElementById('savePetProfileBtn').style.display = 'inline-block';
            document.getElementById('cancelPetProfileBtn').style.display = 'inline-block';
        }

        // Выключение режима редактирования
        function disableEditMode() {
            const textElements = document.querySelectorAll('.pet-info-text');
            textElements.forEach(element => {
                element.style.display = 'block';
            });
            
            const inputElements = document.querySelectorAll('.pet-info-edit');
            inputElements.forEach(element => {
                element.style.display = 'none';
            });
            
            document.getElementById('editPetProfileBtn').style.display = 'inline-block';
            document.getElementById('savePetProfileBtn').style.display = 'none';
            document.getElementById('cancelPetProfileBtn').style.display = 'none';
        }

         // Сохранение данных питомца
        function editPetProfile() {
            const petProfile = {
                name: document.getElementById('petNameInput').value.trim(),
                type: document.getElementById('petSpecieInput').value.trim(),
                breed: document.getElementById('petBreedInput').value.trim(),
                age: document.getElementById('petAgeInput').value.trim(),
                weight: document.getElementById('petWeightInput').value.trim(),
                height: document.getElementById('petHeightInput').value.trim(),
                birthDate: document.getElementById('petBirthDateInput').value.trim(),
            };
            
            savePetProfile(petProfile);

            document.getElementById('petNameText').textContent = petProfile.name || 'Не указано';
            document.getElementById('petSpecieText').textContent = petProfile.type || 'Не указано';
            document.getElementById('petBreedText').textContent = petProfile.breed || 'Не указано';
            document.getElementById('petAgeText').textContent = petProfile.age || 'Не указано';
            document.getElementById('petWeightText').textContent = petProfile.weight || 'Не указано';
            document.getElementById('petHeightText').textContent = petProfile.height || 'Не указано';
            document.getElementById('petBirthDateText').textContent = petProfile.birthDate || 'Не указано';
            
            disableEditMode();
        }

        // Отмена редактирования Data
        function cancelEdit() {
            disableEditMode();
            renderPetProfile();
        }

        // Отображение визитов и лекарств
        function renderVisits() {
            const visits = loadVisits();
            const visitList = document.getElementById('visitList');
            
            visitList.innerHTML = '';
            
            visits.forEach((visit, index) => {
                const visitItem = document.createElement('li');
                visitItem.innerHTML = `
                    <span>${visit.text}</span>
                    <span>${visit.date}</span>
                    <span>${visit.status}</span>
                    <span>${visit.procedure}</span>
                    <div class="visit-actions">
                        <button onclick="deleteVisit(${index})" title="Удалить"><i class="fas fa-trash"></i>Удалить</button>
                    </div>
                `;
                visitList.appendChild(visitItem);
            });
        }

        function renderMedics() {
            const medics = loadMedics();
            const medicList = document.getElementById('medicList');

            medicList.innerHTML = '';

            medics.forEach((medic, index) => {
                const medicItem = document.createElement('li');
                medicItem.innerHTML = `
                    <span>${medic.text}</span>
                    <span>${medic.date}</span>
                    <span>${medic.status}</span>
                    <span>${medic.procedure}</span>
                    <div class="medic-actions">
                        <button onclick="deleteMedic(${index})" title="Удалить"><i class="fas fa-trash"></i>Удалить</button>
                    </div>
                `;
                medicList.appendChild(medicItem);
            });
        }

        // Добавление визита или лекарства
        function addVisit(text, date, status, procedure) {
            const visits = loadVisits();

            visits.push({
                text: text,
                date: date,
                status: status,
                procedure: procedure,
            });

            saveVisits(visits);
            renderVisits();

            document.getElementById('newVisitInput').value = '';
            document.getElementById('newVisitDate').value = '';
            document.getElementById('newVisitStatus').value = '';
            document.getElementById('newVisitProcedure').value = '';
        }

        function addMedic(text, date, status, procedure) {
            const medics = loadMedics();

            medics.push({
                text: text,
                date: date,
                status: status,
                procedure: procedure,
            });

            saveMedics(medics);
            renderMedics();

            document.getElementById('newMedicInput').value = '';
            document.getElementById('newMedicDate').value = '';
            document.getElementById('newMedicStatus').value = '';
            document.getElementById('newMedicProcedure').value = '';
        }

        // Здесь могло бы быть переключение статуса задачи toggleVisit

        // Удаление визита или лекарства
        function deleteVisit(index) {
            const visits = loadVisits();
            visits.splice(index, 1);
            saveVisits(visits);
            renderVisits();
        }

        function deleteMedic(index) {
            const medics = loadMedics();
            medics.splice(index, 1);
            saveMedics(medics);
            renderMedics();
        }

        // Инициализация страницы при загрузке
        document.addEventListener('DOMContentLoaded', function() {
            const currentUser = checkAuth();
            
            if (!currentUser) {
                // Пользователь не авторизован
                document.getElementById('unauthorizedMessage').style.display = 'block';
                document.getElementById('authorizedContent').style.display = 'none';
            } else {
                // Пользователь авторизован
                document.getElementById('unauthorizedMessage').style.display = 'none';
                document.getElementById('authorizedContent').style.display = 'block';
                
                // Заполняем информацию о пользователе
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('userEmail').textContent = currentUser.email;

                // Загружаем данные питомца
                renderPetProfile();
            }

            // Инициализация интерактивных элементов

            // 1. Обработчики для редактирования профиля питомца
            document.getElementById('editPetProfileBtn').addEventListener('click', enableEditMode);
            document.getElementById('savePetProfileBtn').addEventListener('click', editPetProfile);
            document.getElementById('cancelPetProfileBtn').addEventListener('click', cancelEdit);

            // 3. Управление визитами и лекарстами
            renderVisits();
            renderMedics();
            
            // Обработчики для добавления посещений
            document.getElementById('showVisitItemBtn').addEventListener('click', function() {
                document.getElementById('visitItem').style.display = 'block';
            });

            document.getElementById('addVisitBtn').addEventListener('click', function() {
                document.getElementById('visitItem').style.display = 'none';
            });

            document.getElementById('cancelVisitBtn').addEventListener('click', function() {
                document.getElementById('visitItem').style.display = 'none';
            });

            document.getElementById('addVisitBtn').addEventListener('click', function() {
                const input = document.getElementById('newVisitInput');
                const dateInput = document.getElementById('newVisitDate');
                const statusInput = document.getElementById('newVisitStatus');
                const procedureInput = document.getElementById('newVisitProcedure');

                const text = input.value.trim();
                const date = dateInput.value.trim();
                const status = statusInput.value.trim();
                const procedure = procedureInput.value.trim();

                if (text && date && status && procedure) {
                    addVisit(text, date, status, procedure);
                } else {
                    alert('Заполните все поля!');
                }
            });
            
            // Обработчики для добавления лекарств
            document.getElementById('showMedicItemBtn').addEventListener('click', function() {
                document.getElementById('medicItem').style.display = 'block';
            });

            document.getElementById('addMedicBtn').addEventListener('click', function() {
                document.getElementById('medicItem').style.display = 'none';
            });

            document.getElementById('cancelMedicBtn').addEventListener('click', function() {
                document.getElementById('medicItem').style.display = 'none';
            });

            document.getElementById('addMedicBtn').addEventListener('click', function() {
                const input = document.getElementById('newMedicInput');
                const dateInput = document.getElementById('newMedicDate');
                const statusInput = document.getElementById('newMedicStatus');
                const procedureInput = document.getElementById('newMedicProcedure');

                const text = input.value.trim();
                const date = dateInput.value.trim();
                const status = statusInput.value.trim();
                const procedure = procedureInput.value.trim();

                if (text && date && status && procedure) {
                    addMedic(text, date, status, procedure);
                } else {
                    alert('Заполните все поля!');
                }
            });

            // Обработчик кнопки выхода
            document.getElementById('logoutBtn').addEventListener('click', function(e) {
                e.preventDefault();
                logout();
            });
        });
    </script>
</body>
</html>